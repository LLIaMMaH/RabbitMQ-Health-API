# RabbitMQ Health API

![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)
![Python](https://img.shields.io/badge/python-3.12%2B-blue.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-async-success)
![Docker](https://img.shields.io/badge/docker-ready-blue)

–õ—ë–≥–∫–∏–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π HTTP‚Äë—Å–µ—Ä–≤–∏—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ **RabbitMQ** –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è **–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã**, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞ Cloudflare Tunnel (–∏–ª–∏ –¥—Ä—É–≥–∏–º reverse‚Äëproxy) –±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –±—Ä–æ–∫–µ—Ä–∞ –Ω–∞—Ä—É–∂—É.

–ü—Ä–æ–µ–∫—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞:
- Uptime Kuma (HTTP‚Äëhealthcheck)
- —Ä—É—á–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è RabbitMQ
- –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–≤–µ—Ä—Ö–µ–¥ –∏ –ø—Ä–æ—Å—Ç–æ—Ç—É —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

---

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞](#–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∏–¥–µ—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-–∏–¥–µ—è)
3. [–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API](#—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã-api)
4. [–í–∞–∂–Ω–æ –ø—Ä–æ –ø—É—Ç–∏ –∏ .env](#–≤–∞–∂–Ω–æ-–ø—Ä–æ-–ø—É—Ç–∏-–∏-env)
5. [–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π](#—Å—Ç–µ–∫-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π)
6. [–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞](#–∑–∞–ø—É—Å–∫-–ø—Ä–æ–µ–∫—Ç–∞)
7. [Docker –∏ docker-compose](#docker-–∏-docker-compose)
8. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

---

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**RabbitMQ Health API** —Ä–µ—à–∞–µ—Ç —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á:

- üîí RabbitMQ –∏ Management UI **–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∞—Ä—É–∂—É**
- ‚ù§Ô∏è –î–∞—ë—Ç –ø—Ä–æ—Å—Ç–æ–π HTTP‚Äëendpoint –¥–ª—è Uptime Kuma
- üìä –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –±—Ä–æ–∫–µ—Ä–∞ (–æ—á–µ—Ä–µ–¥–∏, —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- üñ•Ô∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –í–ú (CPU / RAM / Disk)

–°–µ—Ä–≤–∏—Å —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è —Ä—è–¥–æ–º —Å RabbitMQ –∏ –æ–±—â–∞–µ—Ç—Å—è —Å –Ω–∏–º **–ª–æ–∫–∞–ª—å–Ω–æ** —á–µ—Ä–µ–∑ Management API.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∏–¥–µ—è

```
Uptime Kuma / Browser
        ‚îÇ  HTTPS
        ‚ñº
RabbitMQ Health API (FastAPI)
        ‚îÇ  localhost
        ‚ñº
RabbitMQ Management API (15672)
```

- AMQP (`5672`) –∏ Management UI (`15672`) **–Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è**
- –Ω–∞—Ä—É–∂—É –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ HTTP‚ÄëAPI
- –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è Cloudflare Tunnel

---

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API

‚ö†Ô∏è –í—Å–µ –ø—É—Ç–∏ –Ω–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã **–¥–ª—è –ø—Ä–∏–º–µ—Ä–∞**. –†–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è `API_BASE_PATH` –≤ `.env`.

### `/health`

```
GET http://localhost:8000/api/rabbitmq/health
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- –æ—Å–Ω–æ–≤–Ω–æ–π healthcheck –¥–ª—è Uptime Kuma
- –±—ã—Å—Ç—Ä—ã–π –∏ –ª—ë–≥–∫–∏–π

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–æ –≤—Å–µ—Ö –æ—á–µ—Ä–µ–¥—è—Ö
- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –±—Ä–æ–∫–µ—Ä–∞
- —Ü–≤–µ—Ç–æ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
  "messages": 124,
  "connections": 5,
  "load_percent": 62.0,
  "level": "üü°"
}
```

–¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è:
- üü¢ `green` ‚Äî –¥–æ 50%
- üü° `yellow` ‚Äî 51‚Äì75%
- üî¥ `red` ‚Äî 76% –∏ –≤—ã—à–µ

---

### `/status`

```
GET http://localhost:8000/api/rabbitmq/status
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- —Ä—É—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è RabbitMQ

**–ß—Ç–æ –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å:**
- –≤–µ—Ä—Å–∏—é RabbitMQ
- uptime –Ω–æ–¥—ã
- —Å–ø–∏—Å–æ–∫ –æ—á–µ—Ä–µ–¥–µ–π
- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤
- –æ–±—â–µ–µ —á–∏—Å–ª–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏**, –∞ –Ω–µ –¥–ª—è —á–∞—Å—Ç–æ–≥–æ –æ–ø—Ä–æ—Å–∞.

---

### `/metrics`

```
GET http://localhost:8000/api/rabbitmq/metrics
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –í–ú

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –∑–∞–≥—Ä—É–∑–∫—É CPU
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞

–ë–µ–∑ Prometheus, –≤ –ø—Ä–æ—Å—Ç–æ–º JSON‚Äë–≤–∏–¥–µ ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞.

---

### `/docs`

```
GET http://localhost:8000/docs
```

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è FastAPI (Swagger UI):
- —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- —Ä–µ–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ —Å —É—á—ë—Ç–æ–º `API_BASE_PATH`
- –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

---

## –í–∞–∂–Ω–æ –ø—Ä–æ –ø—É—Ç–∏ –∏ `.env`

‚ö†Ô∏è **–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç –ø—Ä–æ–µ–∫—Ç–∞** ‚Äî –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –ø—É—Ç–∏ –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `.env`.

```env
API_BASE_PATH=/api/rabbitmq
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:

- –ø—Ä–∏ —Å–º–µ–Ω–µ –∑–Ω–∞—á–µ–Ω–∏—è `API_BASE_PATH`
- **–≤—Å–µ URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—é—Ç—Å—è**

–ü—Ä–∏–º–µ—Ä—ã:

| API_BASE_PATH | –ò—Ç–æ–≥–æ–≤—ã–π URL `/health` |
|--------------|------------------------|
| `/api/rabbitmq` | `/api/rabbitmq/health` |
| `/rabbitmq` | `/rabbitmq/health` |

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–æ–¥ –¥–ª—è dev / prod
- —É–¥–æ–±–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Cloudflare Tunnel

---

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Python 3.12+**
- **FastAPI** ‚Äî HTTP API
- **httpx** ‚Äî –∑–∞–ø—Ä–æ—Å—ã –∫ RabbitMQ Management API
- **psutil** ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –í–ú
- **uv** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **Docker / Docker Compose** ‚Äî —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

---

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
uv venv
source .venv/bin/activate
uv sync
uvicorn app.main:app --reload
```

---

## Docker –∏ docker-compose

–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫:

```bash
docker compose build
docker compose up -d
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

- `http://localhost:14101/api/rabbitmq/health`
- `http://localhost:14101/api/rabbitmq/status`
- `http://localhost:14101/api/rabbitmq/metrics`

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å RabbitMQ: `monitoring`
- –ø—Ä–∞–≤–∞: **read-only**
- Management API –¥–æ—Å—Ç—É–ø–µ–Ω **—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ**
- –Ω–∞—Ä—É–∂—É –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ HTTP‚Äë—Å–µ—Ä–≤–∏—Å

–ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ:  
- [ ] –∑–∞–∫—Ä—ã—Ç—å `/status` –∏ `/metrics` —Ç–æ–∫–µ–Ω–æ–º  
- [ ] –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Cloudflare Access  

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π **MIT**.

* * *

### –ö–∞–∫ –º–æ–∂–Ω–æ –æ—Ç–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—å:
* –û—Ñ–æ—Ä–º–∏—Ç—å —É–¥–æ–±–Ω—É—é –¥–ª—è –≤–∞—Å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ [Boosty.to](https://boosty.to/lliammah/ref)  
* –†–∞–∑–æ–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —á–µ—Ä–µ–∑ [DonationAlerts](https://www.donationalerts.com/r/lliammah)  